\input{common/tex/header}
\input{../listings/clips.tex}
\input{../listings/json.tex}
\input{../listings/pddl.tex}

\usepackage{todonotes}
\usepackage{booktabs}
\newcommand{\tabitem}{~~\llap{\textcolor{FawkesOrange}{\textbullet}}~~}

\hypersetup{
  pdftitle      = {RobotMemory-Proposal-Talk},
  pdfauthor     = {Frederik Zwilling},
  pdfkeywords   = {robotics, artificial intelligence, robot memory, logistics, RCLL, @Home},
  pdfsubject    = {Master Thesis Proposal Talk}
  %hidelinks    = true
}

\title[Robot Memory] {A Document-Oriented Robot Memory\\ for
  Knowledge Sharing and Hybrid Reasoning\\ on Mobile Robots}
\author[Zwilling]{
  \textbf{Frederik Zwilling}\\
  ~Adviser: Tim Niemueller\\
  ~Supervisors: Prof. Lakemeyer, PhD., Prof. Dr. Jarke
}
\def\projecturl{}

\date[Mar 15th 2017]{Mar 15th 2017 -- Master Thesis Presentation}

\begin{document}
\shorthandoff{"} % aus "o kein รถ machen

\frame[plain]{\titlepage}
\addtocounter{framenumber}{-1}

\begin{frame}
  \frametitle{Robot Memory at a Glance}
  \textbf{\large Database to store information of a robot about its environment}
  \bigskip
  \begin{itemize}
  \item \textbf{Domain:} Logistics and domestic service robots
  \item \textbf{Purpose:} Scalable storage and rich querying
  \item \textbf{Focus:} Knowledge sharing and hybrid reasoning\\ for knowledge-based systems
  \end{itemize}
\end{frame}

\begin{frame}
  \tableofcontents[]
\end{frame}
\addtocounter{framenumber}{-1}

\section{Motivation}
\begin{frame}
  \frametitle{Why do robots need a memory?}
  \vspace{1cm}
  \begin{columns}
    \begin{column}{0.5\textwidth}
    \includegraphics[width=\textwidth]{../thesis/img/rcll-feld}
    \begin{itemize}
    \item Store and reason about world state
    \item Share information in multi-robot system
    \end{itemize}
%% share knowledge to collaborate
    \end{column}
    \begin{column}{0.5\textwidth}
    \includegraphics[width=\textwidth]{../thesis/img/pr2-kbsg-kitchen}
    \begin{itemize}
    \item Remember object sights
    \item Persistent storage
    \item Consistent information base for different components
    \end{itemize}
    \end{column}
  \end{columns}
\end{frame}

\begin{frame}
  \frametitle{Robot Memory Goals}
  \begin{itemize}
  \item Flexible storage and retrieval % generic
  \item Memory sharing between knowledge-based systems
  \item Special views for different components
  \item Computation on demand (\emph{Computables})
  \item Distributed memory for multi-robot systems
  \item Spatio-temporal grounding
  \item Notification about updates (\emph{Triggers})
  \item Persistent storage
  \item Human interface and visualization
  \end{itemize}
\end{frame}

%TOC?

\section{Background}
\begin{frame}
  \frametitle{Background: Application Domains}
  \begin{columns}
    \begin{column}{0.5\textwidth}
    \begin{flushleft}
    \includegraphics[width=0.7\textwidth]{../thesis/img/rcll-feld}
    \end{flushleft}
  \begin{description}[]
  \item[RoboCup Logistics League] \hfill \\
    \begin{itemize}
    \item Production logistics\\ in smart factory
    \item Share world model
    \begin{itemize}
    \item between robots
    \item between global planner and reasoner executive
    \end{itemize}
    \end{itemize}
  \end{description}
    \end{column}
    \begin{column}{0.5\textwidth}
    \begin{flushright}
    \includegraphics[width=0.7\textwidth]{../thesis/img/pr2-kbsg-kitchen}
    \end{flushright}
  \begin{description}[]
  \item[RoboCup@Home] \hfill \\
    \begin{itemize}
    \item Domestic service robots
    \item Collect knowledge about concrete environment
    \item Hybrid reasoning with spatio-temporal knowledge
    \item Persistent storage
    \end{itemize}
  \end{description}    
    \end{column}
  \end{columns}
%TODO: already intorduce evaluation scenario here?
  \end{frame}

\begin{frame}
  \frametitle{Background: Fawkes}
  \includegraphics[width=0.25\textwidth]{../thesis/img/fawkes}  
  \bigskip
  \begin{itemize}
    \item Robot Software Framework % used in application domains
    \item Component-based software design % RM one of those components
    \item Hybrid blackboard communication infrastructure\\ with specific interfaces/messages % but no generic memory
      \skip
    \item[$\Rightarrow$] Robot Memory available as Fawkes plugin
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Background: Planners and Reasoners}
  \begin{columns}
  \begin{column}{0.83\linewidth}
  \begin{description}[]
  \item[CLIPS Rules Engine] \hfill \\
  \begin{itemize}
  \item First-Order Logic forward chaining system
  \item Fact base and condition-action rules
  \item[$\Rightarrow$] Good for world model reasoning and\\ execution monitoring
  \end{itemize}
  \item[Planning Domain Definition Language (PDDL)]%<uncover@2->
    \hfill \\
  \begin{itemize}
  \item Standardized language for planning problems
  \item Find action sequence through heuristic search
  \item[$\Rightarrow$] Good for finding global plans
  \end{itemize}
  \item[Motion Planners]%<uncover@3->
    \hfill \\
  \begin{itemize}
  \item Robot arm and locomotion collision avoidance
  \item Depend on geometric data
  \end{itemize}
  \end{description}
  \end{column}
  \begin{column}{0.17\linewidth}
  \includegraphics[width=\textwidth]{../thesis/img/CLIPS}
  \vspace{3.4cm}
  %\pause\pause
  \includegraphics[width=\textwidth]{../thesis/img/openrave}
  \end{column}
  \end{columns}
\end{frame}

\section{Related Work}
\begin{frame}
  \frametitle{Related Work: Robot Information Storage Systems}
  \begin{description}[]
  \item[KnowRob~\cite{KnowRob}]%<uncover@1->
    \hfill \\
    \begin{itemize}
    \item Common sense reasoning with ontologies
          %explain with example (graph, rdf, milk)
    \item Virtual knowledge base to interface perception
    \item Based on Prolog
    \end{itemize}
  \end{description}
  \begin{description}[]
  \item[OpenRobots Ontology~\cite{Oro}]%<uncover@2-> 
    \hfill \\
    \begin{itemize}
    \item Common sense reasoning with ontologies
    \item Events notifying about changes
    \item Based on  Java
    \end{itemize}
  \end{description}
  \begin{block}{}%<uncover@3->
  \begin{itemize}
  \item Not applicable for multi-robot systems
  \item Scalability, efficiency concerns % because storage is interwined with reasoning
  \item Missing events / computation on demand
  \end{itemize}
  \end{block}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Document Orientation}

  \begin{itemize}
  \item Documents: Sets of key-value pairs
    %keys unique, different value types
  \item Java Script Object Notation (JSON)
    \begin{lstlisting}[style=SmallJSON,linewidth=8.5cm,
      label=lst:json,
      framexleftmargin=1pt, xleftmargin=0pt,
      morekeywords={}, numbers=none]
      {
        "key": "value",
        "subdocument": {"x":3, "y":1},
        "array": [{"n":0.1},{"n":2}]
      }
    \end{lstlisting}
  \item Denormalized (information bundled in documents)
  \item Schema free
  \end{itemize}
  \begin{itemize}
  \item[$\Rightarrow$] Allows generic, flexable, and distributable robot memory
  \end{itemize}
\end{frame}

\begin{frame}[fragile]
  \frametitle{MongoDB Database System}
  \hfill\includegraphics[width=0.3\textwidth]{../thesis/img/mongodb}
  \begin{itemize}
    \item Document-oriented
    \item Scalable, powerful and widely used
    \item Collections group documents
    \item Query language with aggregation, MapReduce, JavaScript %expressive
\begin{lstlisting}[style=SmallJSON,linewidth=8.5cm,
  framexleftmargin=2pt, xleftmargin=10pt,
 morekeywords={}, numbers=none]
db.environment.find(
  { object: "cup", color: {$ne: "red"}})
\end{lstlisting}%$
    \item Indexing for fast querying
    \item Distributable with Replica Sets\\ %explain a bit (Primary, Secondary)
      Operations Log (Oplog) to forward changes
    \item Performance and scalability advantages compared to other database systems, e.g., ArangoDB, CouchDB\\\cite{arango-vs-mongo,db-comparison}
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Related Work with MondoDB}
  \begin{description}
  \item[Generic Robot Database with MongoDB~\cite{RoboDB}]%<uncover@1->
                \hfill \\
    \begin{itemize}
    \item Data logging for evaluation and fault analysis
    \item Generic and scalable storage with MongoDB
    \item Integration in Fawkes and ROS
    \end{itemize}
\bigskip
  \item[Extentions of  MongoDB]%<uncover@2->
                \hfill \\
    \begin{itemize}
    \item Triggers with replication Oplog~\cite{mongodb-trigger}
    \item Multi-Master Replication~\cite{mongodb-multi-master}
    \end{itemize}
  \end{description}
\end{frame}

%TOC?

\section{Approach}
\begin{frame}
  \frametitle{Theoretical Foundation (sketch)}
  \todo[inline]{Sketch/Full/Or Something else?}
\end{frame}

\begin{frame}[fragile]
  \frametitle{Computables}
  \begin{description}
  \item[Advantages of on demand computation]%<uncover@1->
                \hfill \\
    \begin{itemize}
    \item Interfacing of perception and complex computation in KBS % to bypass expressiveness/complexity
    \item Decreased computational effort % compared to continously store %e.g. perception, transform, distance
    \item Simplify hybrid reasoning by transforming between\\ spatio-temporal and symbolic information
    \end{itemize}
  \item[Computables]%<uncover@2->
                \hfill \\
    \begin{itemize}
    \item Function: Query $x$ Robot-State $\rightarrow$ Set of documents
    \item Computable specification
    \item Priority % to order evaluation because of dependencies between computables
    \end{itemize}
  \item[Example]%<uncover@3->
  \end{description}

\begin{minipage}[b]{.27\textwidth}
\begin{lstlisting}[style=ReallySmallJSON,
  framexleftmargin=5pt, xleftmargin=0pt,
 morekeywords={}, numbers=none]
{
  compute: "sum",
  x: {$exists:true},
  y: {$exists:true}
}
\end{lstlisting}
Computable\\specification
\end{minipage}%
\hfill
\begin{minipage}[b]{.25\textwidth}
\begin{lstlisting}[style=ReallySmallJSON,
  framexleftmargin=5pt, xleftmargin=0pt,
 morekeywords={}, numbers=none]
{
  compute: "sum",
  x: 15,
  y: 4
}
\end{lstlisting}
Query requiring the computable
\end{minipage}%
\hfill
\begin{minipage}[b]{.25\textwidth}
\begin{lstlisting}[style=ReallySmallJSON,
  framexleftmargin=5pt, xleftmargin=0pt,
 morekeywords={}, numbers=none]
{
  compute: "sum",
  x: 15,
  y: 4,
  sum: 19
}
\end{lstlisting}
  \vspace{-0.1cm}
Resulting document
\end{minipage}%
\end{frame}

\begin{frame}
  \frametitle{Triggers}
  \begin{description}
  \item[Trigger: Notification about events in the robot memory]%<uncover@1->
                \hfill \\
    \begin{itemize}
    \item Queries define changes of single documents, e.g., \texttt{\{relation: "order"\}}
    \item Callback with matching document, timestamp, and operation type
    \item Avoids polling
    \item Use cases: World model updates, Messaging % e.g. multi-robot system, new plan
    \end{itemize}
  \item[Implementation]%<uncover@2->
                \hfill \\
    \begin{itemize}
    \item Searching replication Oplog for changes
    \item Tailable cursor in capped collection % give intuition ring buffer
    \end{itemize}
  \end{description}
\end{frame}

\begin{frame}
  \frametitle{Architecture}
  \center
  \includegraphics[width=0.8\textwidth]{../thesis/architecture.pdf}
\end{frame}

\section{Implementation}
\begin{frame}
  \frametitle{MongoDB BackEnd + Distribution}
\end{frame}
\begin{frame}
  \frametitle{RobotMemory (query language, operations, computables, triggers)?}

caching of computables
blackboard+transform computable?
\end{frame}
\begin{frame}
  \frametitle{CLIPS}
\end{frame}
\begin{frame}
  \frametitle{PDDL}
\end{frame}
\begin{frame}
  \frametitle{OpenRAVE}
\end{frame}
\begin{frame}
  \frametitle{Demo Videos}
\end{frame}
\section{Evaluation}
\begin{frame}
  \frametitle{qualitative (performance in scenarios)}

note trigger+computable?
trigger only on single documents (denormalization, computational complexity vs expressiveness)
\end{frame}
\begin{frame}
  \frametitle{graphs}
\end{frame}
\section{Conclusion}
\begin{frame}
  \frametitle{Future Work}
\end{frame}
\begin{frame}
  \frametitle{Summary and Questions}
\todo[inline]{review + challenges}
  \begin{block}{} \centering\bfseries The generic robot memory is capable of
    efficiently storing and querying arbitrary symbolic or geometric information
    and allows consistent knowledge sharing.
  \end{block}

  \bigskip

  \begin{itemize}
  \item Document-oriented representation and querying
  \item Theoretical and architectural design
  \item Interfaces for knowledge based systems
  \item Computables for on demand knowledge computation
  %% \item Implementation with MongoDB in Fawkes
  \item RCLL and @Home as application and evaluation domains
  \item Foundation for future projects
  \end{itemize}
\end{frame}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%



\begin{frame}[allowframebreaks]
  \frametitle{References}
  \small
  \bibliographystyle{apalike}
  \bibliography{../references}
\end{frame}

% Backup Slides

\begin{frame}
  \frametitle{Theoretical Foundation}
\begin{description}[]
  \item[Definition of documents representing knowledge] \hfill \\
  \small e.g.~$\{("object","cup"),("room","kitchen"),("position",{\scriptstyle\{("x",8),("y",4)\}})\}$
  \pause
  \begin{enumerate}
\item \textbf{Keys:} $\mathcal{K} := \Sigma^*$
\item  \textbf{Atomic values:} $\mathcal{V}_0$ are constants
\item \textbf{Unnested key-value pairs:} $\mathcal{P}_0:=\mathcal{K}\times\mathcal{V}_0$
\item \textbf{Unnested documents:} \vspace{-0.3cm}
%are sets of key-value pairs with unique keys and thus included in the power set of $\mathcal{P}_0$:\\
\begin{align*}
\mathcal{D}_0:=\{
  d\in\mathbb{P}(\mathcal{P}_0)|
  \forall (k,v),(k',v')\in d , k\neq k' \vee (k,v)=(k',v')
  \}
\end{align*}
\end{enumerate}
  \item[With nesting] \hfill \\
  \begin{enumerate}
\item  \textbf{Values:} $\mathcal{V}_n := \mathcal{V}_{n-1} \cup \mathcal{D}_{n-1}$
\item \textbf{Key-Value Pairs:} $\mathcal{P}_n:=\mathcal{K}\times\mathcal{V}_n$
\item \textbf{Documents:} \vspace{-0.3cm}
\begin{align*}
  \mathcal{D}_n:=\{
  d\in\mathbb{P}(\mathcal{P}_n)|
  \forall (k,v),(k',v')\in d , k\neq k' \vee (k,v)=(k',v')
  \}
\end{align*}
\end{enumerate}
  \end{description}
  \pause
  \textbf{Finitely nested documents:} $\mathcal{D}=\cup_{n\in\mathbb{N}}\mathcal{D}_n$\\
  \textbf{Values:} $\mathcal{V}=\cup_{n\in\mathbb{N}}\mathcal{V}_n$
\end{frame}

\begin{frame}
  \frametitle{Theoretical Foundation}
  \begin{description}[]
  \item[Definition Robot Memory] \hfill \\
    \begin{enumerate}
      \item \textbf{Database:} finite set $\mathcal{DB} \subset \mathcal{D}$
      \item \textbf{Query:} represented by document $q\in\mathcal{D}$\\
      yields set of documents $r\subset\mathcal{DB}$ as result\\
      e.g. $q=\{("object","cup"),("room","kitchen")\}$
      \item \textbf{Computable:} $f: \mathcal{D} \rightarrow \mathbb{P}(\mathcal{D})$
      % providing computable knowledge on demand
      %computability and termination ensured by providing component
      \item \textbf{Set of Computables:} $\mathcal{C}$
      \item \textbf{Robot Memory:} $\mathcal{RM}=(\mathcal{DB},\mathcal{C})$
      \item \textbf{Memorized Documents:} $mem(\mathcal{RM})=\mathcal{DB} \cup \bigcup_{f\in\mathcal{C}}f(\mathcal{D})$
    \end{enumerate}
  \end{description}  
\end{frame}

\begin{frame}
  \frametitle{Theoretical Foundation}
    \begin{description}[]
  \item[Mapping into PDDL] \hfill \\
\vspace{-0.5cm}
\small\begin{align*}
\text{e.g. } map_p&(\{("predicate", "at"),("object", "cup"),("room","kitchen")\})\\
             &= at(map_f("cup"), map_f("kitchen")) = at(cup, kitchen) \text{.}
\end{align*}
\pause
  \begin{enumerate}
      \item \textbf{Predicate symbols} $\mathcal{R}$, \textbf{Function symbols} $\mathcal{F}$
      \item \textbf{Name mapping:}
      \begin{align*}
        name_{pred}: \mathcal{R} \rightarrow \Sigma^* &\text{ and } name_{func}: \mathcal{F} \rightarrow \Sigma^*\\
        %injective, disjunct
        name_{pred-atr}: \mathcal{R} \times \mathbb{N} \rightarrow \mathcal{K} &\text{ and } name_{func-atr}: \mathcal{F} \times \mathbb{N} \rightarrow
\mathcal{K}
      \end{align*}
      \only<1-2>{
      \item \textbf{Map to predicate:}
      \begin{align*}
        map_p(d)=&\text{ }p(map_f(v_1), ..., map_f(v_n)), \text{ iff } p \text{ is a n-array predicate in } \mathcal{R},\\
  ("predica&te", name_{pred}(p))\in d, \forall i \in \{1..n\} (name_{pred-atr}(p,i), v_i)\in d\\
  map_p(d)=& \text{ }nil_p, otherwise
      \end{align*}}
      \only<3>{
      \item \textbf{Map to predicate}
      \item \textbf{Map to function term:}
      \begin{align*}
        map_f(v)= &\text{ }v, v \in \mathcal{V}_0\\
        map_f(d)= &\text{ }f(map_f(v_1), ..., map_f(v_n)), \text{ iff } f \text{ is a n-array function in } \mathcal{F},\\
  ("functio&n", name_{func}(f))\in d, \forall i \in \{1..n\} (name_{func-atr}(f,i), v_i)\in d\\
  map_f(d)= &\text{ } nil_f, otherwise
      \end{align*}}
    \end{enumerate}
  \end{description}
\end{frame}
\begin{frame}[fragile]
  \frametitle{Trigger/Oplog document}
\begin{lstlisting}[style=SmallJSON,
  caption={Document in the Oplog},
  label=lst:Oplog,
  framexleftmargin=2pt, xleftmargin=0pt,
 morekeywords={}, numbers=none]
{
  ns: "syncedrobmem.clipswm",
  ts: Timestamp(1485369072, 5),
  op: "i",
  o: {
    _id : ObjectId("58c14a14"),
    relation: "order",
    id: 2,
    complexity: "C0",
    delivery-gate: 3,
    quantity-requested: 1,
    quantity-delivered: 0,
    begin: 209,
    end: 282 }
}
\end{lstlisting}
\end{frame}
\end{document}
